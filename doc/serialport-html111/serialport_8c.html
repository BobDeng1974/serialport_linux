<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Serial Port: /home/latelee/test/serialport_linux/src/serialport.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.8 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>/home/latelee/test/serialport_linux/src/serialport.c File Reference</h1>Some utils of the serial port, such as open the port, close the port and setup the port. <a href="#_details">More...</a>
<p>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &lt;unistd.h&gt;</code><br>
<code>#include &lt;fcntl.h&gt;</code><br>
<code>#include &lt;termios.h&gt;</code><br>
<code>#include "<a class="el" href="debug-msg_8h-source.html">debug-msg.h</a>"</code><br>
<table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="serialport_8c.html#a0">USB_SERIAL</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="serialport_8c.html#a1">open_port</a> (int port)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="serialport_8c.html#a2">close_port</a> (int fd)</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="serialport_8c.html#a3">setup_port</a> (int fd, int speed, int data_bits, int parity, int stop_bits)</td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Some utils of the serial port, such as open the port, close the port and setup the port. 
<p>
Copyleft (C) 2010 Late Lee This program is tested on LINUX PLATFORM, WITH GCC 4.x. The program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY. Please feel free to use the program, and I feel free to ignore the related issues. Any questions or suggestions, or bugs, please contact me at &lt;$ echo -n "aHR0cDovL3d3dy5sYXRlbGVlLm9yZwo=" | base64 -d&gt; or e-mail to &lt;$ echo -n "bGF0ZWxlZUAxNjMuY29tCg==" | base64 -d&gt; if you want to do this.<p>
<dl compact><dt><b>Author:</b></dt><dd>Late Lee </dd></dl>
<dl compact><dt><b>Date:</b></dt><dd>Mon Jan 10 2011</dd></dl>
<p>
<dl compact><dt><b>Note:</b></dt><dd>This is a note. </dd></dl>
<dl compact><dt><b>Warning:</b></dt><dd>This is a warning. </dd></dl>
<dl compact><dt><b><a class="el" href="bug.html#_bug000001">Bug:</a></b></dt><dd>This is a bug.</dd></dl>
<p>
<dl compact><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>To do something. </dd></dl>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="a0" doxytag="serialport.c::USB_SERIAL" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define USB_SERIAL&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
if you have a usb-serial converter, specify it to 1     </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="a2" doxytag="serialport.c::close_port" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int close_port           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>fd</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
close_port - Close the port<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>fd</em>&nbsp;</td><td>: The file description returned by <a class="el" href="serialport_8c.html#a1">open_port()</a>.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Return 0 if success, return -1 with some msg if error happens. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="a1" doxytag="serialport.c::open_port" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int open_port           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>port</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
open_port - Open a serial port<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>port</em>&nbsp;</td><td>: The port number, eg, open_port(1) will open port 1.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Return fd if success, otherwise will return -1 with some msg.</dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>Each serial port on a UNIX system has one or more device files (files in the /dev directory) associated with it:</dd></dl>
<div class="fragment"><pre>
System         Port 1      Port 2
IRIX          /dev/ttyf1   /dev/ttyf2
HP-UX         /dev/tty1p0  /dev/tty2p0
Solaris/SunOS /dev/ttya    /dev/ttyb
Linux         /dev/ttyS0   /dev/ttyS1
Linux         /dev/ttyUSB0 /dev/ttyUSB1 (usb-serial converter)
Digital UNIX  /dev/tty01   /dev/tty02
(Windows       COM1        COM2)
</pre></div><p>
We open the port specified by port number, for instance, if you want to open port 1, you just call the function like this: open_port(1).     </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="serialport.c::setup_port" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int setup_port           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int&nbsp;</td>
          <td class="mdname" nowrap> <em>fd</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>speed</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>data_bits</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>parity</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>stop_bits</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
setup_port - Configure the port, eg. baud rate, data bits,etc.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>fd</em>&nbsp;</td><td>: The serial port </td></tr>
    <tr><td></td><td valign=top><em>speed</em>&nbsp;</td><td>: The baud rate </td></tr>
    <tr><td></td><td valign=top><em>data_bits</em>&nbsp;</td><td>: The data bits </td></tr>
    <tr><td></td><td valign=top><em>parity</em>&nbsp;</td><td>: The parity bits </td></tr>
    <tr><td></td><td valign=top><em>stop_bits</em>&nbsp;</td><td>: The stop bits</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Return 0 if everything is OK, otherwise -1 with some error msg. </dd></dl>
<dl compact><dt><b>Note:</b></dt><dd>Here are termios structure members:</dd></dl>
<div class="fragment"><pre>
Member      Description 
c_cflag     Control options 
c_lflag     Line options 
c_iflag     Input options 
c_oflag     Output options 
c_cc        Control characters 
c_ispeed    Input baud (new interface) 
c_ospeed    Output baud (new interface) 

</pre></div>The c_cflag member controls the baud rate, number of data bits, parity, stop bits, and hardware flow control. There are constants for all of the supported configurations. Constant Description<p>
<div class="fragment"><pre>
CBAUD	Bit mask for baud rate 
B0	0 baud (drop DTR) 
B50	50 baud 
B75	75 baud 
B110	110 baud 
B134	134.5 baud 
B150	150 baud 
B200	200 baud 
B300	300 baud 
B600	600 baud 
B1200	1200 baud 
B1800	1800 baud 
B2400	2400 baud 
B4800	4800 baud 
B9600	9600 baud 
B19200	19200 baud 
B38400	38400 baud 
B57600	57,600 baud 
B76800	76,800 baud 
B115200	115,200 baud 
EXTA	External rate clock 
EXTB	External rate clock 
CSIZE	Bit mask for data bits 
CS5 5	data bits 
CS6 6	data bits 
CS7 7	data bits 
CS8 8	data bits 
CSTOPB	2 stop bits (1 otherwise) 
CREAD	Enable receiver 
PARENB	Enable parity bit 
PARODD	Use odd parity instead of even 
HUPCL	Hangup (drop DTR) on last close 
CLOCAL	Local line - do not change "owner" of port 
LOBLK	Block job control output 
CNEW_RTSCTS CRTSCTS	Enable hardware flow control (not supported on all 
			platforms) 

</pre></div><p>
The input modes member c_iflag controls any input processing that is done to characters received on the port. Like the c_cflag field, the final value stored in c_iflag is the bitwise OR of the desired options.<p>
<div class="fragment"><pre>
Constant	Description 
INPCK	Enable parity check 
IGNPAR	Ignore parity errors 
PARMRK	Mark parity errors 
ISTRIP	Strip parity bits 
IXON	Enable software flow control (outgoing) 
IXOFF	Enable software flow control (incoming) 
IXANY	Allow any character to start flow again 
IGNBRK	Ignore break condition 
BRKINT	Send a SIGINT when a break condition is detected 
INLCR	Map NL to CR 
IGNCR	Ignore CR 
ICRNL	Map CR to NL 
IUCLC	Map uppercase to lowercase 
IMAXBEL	Echo BEL on input line too long 
</pre></div><p>
Here are some examples of setting parity checking: <br>
<p>
No parity (8N1): <div class="fragment"><pre>
options.c_cflag &amp;= ~PARENB
options.c_cflag &amp;= ~CSTOPB
options.c_cflag &amp;= ~CSIZE;
options.c_cflag |= CS8;
</pre></div><p>
Even parity (7E1): <div class="fragment"><pre>
options.c_cflag |= PARENB
options.c_cflag &amp;= ~PARODD
options.c_cflag &amp;= ~CSTOPB
options.c_cflag &amp;= ~CSIZE;
options.c_cflag |= CS7;
</pre></div><p>
Odd parity (7O1): <div class="fragment"><pre>
options.c_cflag |= PARENB
options.c_cflag |= PARODD
options.c_cflag &amp;= ~CSTOPB
options.c_cflag &amp;= ~CSIZE;
options.c_cflag |= CS7;
</pre></div>    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Sun Apr 7 12:56:56 2013 for Serial Port by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.8 </small></address>
</body>
</html>
